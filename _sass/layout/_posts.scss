/* ============================================================================
   COMPONENTS / POST.SCSS (V2 - Professional Edition)
   ============================================================================ */

// --- Keyframe Animations ---
@keyframes slideInFromLeft {
  from { transform: translateX(-100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* ============================================================================
   1. HEADER HERO
   ============================================================================ */
.post-header-hero {
  background-color: var(--sf-bg-1);
  border-bottom: 1px solid var(--sf-line-2);
  padding: var(--sf-6) 0;
  margin-bottom: var(--sf-4);
  animation: fadeIn 0.5s ease-out;
}

.breadcrumb {
  @include cluster(var(--sf-2), center);
  font-size: var(--sf-text-sm);
  margin-bottom: var(--sf-6);
  a {
    color: var(--sf-fg-2);
    text-decoration: none;
    transition: color 0.2s ease;
    &:hover { color: var(--sf-brand); }
  }
  span { color: var(--sf-muted); }
  i { color: var(--sf-muted); }
}

.post-title-main {
  font-size: clamp(2rem, 1.5rem + 2.5vw, 3.25rem);
  font-weight: 800;
  line-height: var(--sf-leading-tight);
  color: var(--sf-fg);
  margin: 0 0 var(--sf-4) 0;
}

.post-meta-main {
  @include cluster(var(--sf-5), center, flex-start, wrap);
  color: var(--sf-fg-2);
  margin-bottom: var(--sf-6);
  span, time { @include cluster(var(--sf-2), center); }
  i { font-size: 1.25rem; color: var(--sf-fg-3); }
}

.post-feature-image-main {
  margin: 0;
  img {
    width: 100%;
    max-height: 500px;
    object-fit: cover;
    border-radius: var(--sf-radius-lg);
    border: 1px solid var(--sf-line-2);
    box-shadow: var(--sf-shadow-sm);
  }
}

/* ============================================================================
   2. MAIN GRID & SIDEBARS
   ============================================================================ */
#sticky-sidebar-trigger {
  position: absolute;
  top: 0;
  height: 1px;
}

.post-grid-container {
  display: grid;
  padding-inline: var(--sf-container-padding);
  margin-inline: auto;
  grid-template-columns: minmax(0, 1fr);
  gap: var(--sf-8);
  
  @include breakpoint(lg) {
    grid-template-columns: minmax(0, 1fr) 320px;
    gap: var(--sf-8);
  }

  @include breakpoint(xl) {
    max-width: 1600px;
    grid-template-columns: 1fr minmax(auto, 80ch) 1fr; // Content width based on readability
    gap: var(--sf-6);
  }
}

.post-sidebar-left,
.post-sidebar-right {
  display: none;

  @include breakpoint(lg) {
    &.post-sidebar-right {
      display: flex;
      flex-direction: column;
      gap: var(--sf-6);
    }
  }

  @include breakpoint(xl) {
    display: flex;
    flex-direction: column;
    gap: var(--sf-6);
  }
}

// Sticky Behavior via JS
body.sidebars-sticky {
  .post-sidebar-left, .post-sidebar-right {
    .ad-placeholder--skyscraper, .sf-card {
      position: sticky;
      top: calc(var(--sf-nav-height) + var(--sf-4));
      align-self: start;
    }
  }
}

/* ============================================================================
   3. MAIN CONTENT & TYPOGRAPHY
   ============================================================================ */
.post-content-main {
  @include breakpoint(xl) {
    grid-column: 2 / 3;
  }
}

// The `.typeset` class provides rich styling for generated markdown content.
.post-body.typeset {
  font-size: 1.125rem;
  color: var(--sf-fg);
  line-height: var(--sf-leading-relaxed);

  > *:first-child { margin-top: 0; }
  
  p, ul, ol, blockquote, .ad-placeholder, pre { margin-bottom: var(--sf-5); }
  
  h2, h3, h4, h5, h6 { 
    margin: var(--sf-10) 0 var(--sf-4) 0;
    line-height: var(--sf-leading-tight);
    font-weight: 700;
    color: var(--sf-fg);
  }
  h2 { font-size: var(--sf-text-2xl); border-bottom: 1px solid var(--sf-line-2); padding-bottom: var(--sf-2); }
  h3 { font-size: var(--sf-text-xl); }
  h4 { font-size: var(--sf-text-lg); }
  
  a {
    color: var(--sf-link);
    text-decoration: underline;
    text-decoration-color: color-mix(in srgb, var(--sf-brand) 30%, transparent);
    text-underline-offset: 3px;
    transition: all .2s ease;
    &:hover {
      background-color: color-mix(in srgb, var(--sf-brand) 10%, transparent);
      text-decoration-color: var(--sf-brand);
    }
  }

  ul, ol { padding-left: var(--sf-5); }
  li { margin-bottom: var(--sf-2); }
  li::marker { color: var(--sf-brand); font-weight: 600; }
  
  blockquote {
    border-left: 4px solid var(--sf-brand);
    padding-left: var(--sf-5);
    margin-left: 0;
    font-style: italic;
    color: var(--sf-fg-2);
    p { margin-bottom: 0; }
  }

  pre {
    background-color: var(--sf-bg-1);
    border: 1px solid var(--sf-line-2);
    border-radius: var(--sf-radius-md);
    padding: var(--sf-4);
    overflow-x: auto;
    font-size: var(--sf-text-sm);
  }
  code {
    font-family: var(--sf-font-mono);
    background-color: var(--sf-bg-1);
    border: 1px solid var(--sf-line-2);
    padding: .1em .3em;
    border-radius: var(--sf-radius-sm);
    font-size: 0.9em;
  }
  pre > code { padding: 0; background: none; border: none; }

  hr {
    border: 0;
    height: 1px;
    background-color: var(--sf-line-2);
    margin: var(--sf-8) 0;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--sf-5);
    border: 1px solid var(--sf-line-2);
  }
  th, td {
    border: 1px solid var(--sf-line-2);
    padding: var(--sf-3) var(--sf-4);
    text-align: left;
  }
  thead {
    background-color: var(--sf-bg-1);
    font-weight: 600;
  }
}

/* ============================================================================
   4. POST COMPONENTS (SHARE, BIO, COMMENTS)
   ============================================================================ */
.post-share-strip {
  @include cluster(var(--sf-2), center);
  border-block: 1px solid var(--sf-line-2);
  padding-block: var(--sf-3);
  margin-bottom: var(--sf-8);

  &--footer { margin-top: var(--sf-8); margin-bottom: 0; }
  &__label { font-weight: 600; color: var(--sf-fg-2); margin-right: var(--sf-3); }

  .share-btn {
    display: inline-flex;
    font-size: 1.5rem;
    padding: var(--sf-2);
    border-radius: 50%;
    color: var(--sf-fg-3);
    transition: all .2s ease;
    &:hover {
      transform: translateY(-2px) scale(1.1);
      &.twitter { color: #1DA1F2; background-color: rgba(#1DA1F2, 0.1); }
      &.linkedin { color: #0A66C2; background-color: rgba(#0A66C2, 0.1); }
      &.facebook { color: #1877F2; background-color: rgba(#1877F2, 0.1); }
      &.email { color: var(--sf-brand); background-color: color-mix(in srgb, var(--sf-brand) 10%, transparent); }
    }
  }
}

.post-author-bio {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: var(--sf-5);
  align-items: center;
  background-color: var(--sf-bg-1);
  padding: var(--sf-6);
  border: 1px solid var(--sf-line-2);
  border-radius: var(--sf-radius-lg);
  margin-block: var(--sf-10);
  &__avatar { width: 80px; height: 80px; border-radius: 50%; }
  h4 { margin: 0 0 var(--sf-2) 0; font-size: var(--sf-text-lg); }
  p { margin: 0; color: var(--sf-fg-2); font-size: 1rem; }
}

.post-comments {
  margin-top: var(--sf-10);
}

/* ============================================================================
   5. SIDEBAR WIDGETS (TOC, COFFEE)
   ============================================================================ */
.toc-card {
  padding: var(--sf-4);
  max-height: calc(100vh - var(--sf-nav-height) - 200px); // Prevent long TOC from pushing page
  overflow-y: auto;
  
  .card-header { // Assuming toc.html uses this
    padding: 0 0 var(--sf-3) 0;
    font-weight: 600;
  }
  .toc-list {
    list-style: none; padding: 0; margin: 0;
    a {
      display: block; padding: var(--sf-2) var(--sf-3); text-decoration: none; border-radius: var(--sf-radius-sm);
      color: var(--sf-fg-2); font-size: var(--sf-text-sm); border-left: 2px solid transparent;
      transition: all .2s ease;
      &:hover { background-color: var(--sf-bg-1); color: var(--sf-brand); }
    }
  }
}

// Mobile TOC (JS moved)
#toc-mobile-target .toc-card {
  background-color: var(--sf-bg-1);
  border: 1px solid var(--sf-line-2);
  margin-bottom: var(--sf-8);
  padding: var(--sf-5);
}

.coffee-card, .sponsor-card {
  display: flex;
  flex-direction: column;
  text-align: center;
  gap: var(--sf-3);
  padding: var(--sf-5);
  background-color: var(--sf-bg-1);
  border: 1px solid var(--sf-line-2);

  i { font-size: 2.5rem; color: var(--sf-brand); }
  strong { font-size: var(--sf-text-lg); }
  p { font-size: var(--sf-text-sm); color: var(--sf-fg-2); margin: 0; }
  .sf-btn { margin-top: var(--sf-2); }
}

/* ============================================================================
   6. MOBILE-ONLY ADS & UI
   ============================================================================ */
.mobile-bottom-float {
  position: fixed;
  bottom: 0;
  left: 0; right: 0;
  z-index: var(--sf-z-fixed);
  box-shadow: 0 -4px 12px rgba(0,0,0,.1);
  transform: translateY(100%);
  animation: slideInFromBottom 0.5s ease-out 1s forwards;

  @include breakpoint(md) { display: none; }
}

@keyframes slideInFromBottom {
  to { transform: translateY(0); }
}

.slide-in-ad {
  position: fixed;
  bottom: var(--sf-4);
  left: var(--sf-4);
  z-index: var(--sf-z-modal);
  width: min(320px, calc(100vw - (2 * var(--sf-4))));
  background-color: var(--sf-bg-2);
  border-radius: var(--sf-radius-lg);
  box-shadow: var(--sf-shadow-lg);
  transform: translateX(-120%);
  transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  
  &.is-visible { transform: translateX(0); }

  @include breakpoint(md) { display: none; }

  &__header {
    @include cluster(var(--sf-2), center, space-between);
    padding: var(--sf-2) var(--sf-4);
    border-bottom: 1px solid var(--sf-line-2);
    span { font-size: var(--sf-text-xs); color: var(--sf-muted); font-weight: 500; }
  }
  &__close {
    @include button-reset;
    @include center;
    cursor: pointer;
    color: var(--sf-muted);
    font-size: 1.2rem;
    padding: var(--sf-1);
    &:hover { color: var(--sf-fg); }
  }
}

/* ============================================================================
   7. AD PLACEHOLDERS
   ============================================================================ */
.ad-placeholder {
  @include center;
  background-color: var(--sf-bg-1);
  border: 1px dashed var(--sf-line-1);
  border-radius: var(--sf-radius-md);
  color: var(--sf-muted);
  font-size: var(--sf-text-sm);
  text-align: center;
  width: 100%;
  
  &--skyscraper {
    min-height: 600px;
    max-width: 160px;
    margin-inline: auto;
  }
  &--slide-in, &--mobile-banner {
    border: none;
    border-radius: 0;
    background-color: var(--sf-bg-2);
  }
  &--mobile-banner { min-height: 50px; }
  &--slide-in { min-height: 250px; border-radius: 0 0 var(--sf-radius-lg) var(--sf-radius-lg); }
}